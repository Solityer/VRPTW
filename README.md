# VRPTW 求解器：带时间窗的车辆路径问题优化方案

## 项目简介

本项目实现了一个针对带时间窗的车辆路径问题（Vehicle Routing Problem with Time Windows, VRPTW）的优化求解器。该求解器能够根据客户需求、时间窗约束和车辆容量限制，自动规划最优配送路径，最小化使用的车辆数量和总行驶距离，同时确保满足所有约束条件。

## 功能特点

- 自动解析标准 VRPTW 数据文件（C1_*.txt 格式）
- 采用改进的智能聚类算法对客户进行分组
- 结合时间窗约束和容量限制优化路径规划
- 支持对未服务客户进行重新分配
- 生成详细的求解结果报告和 Excel 格式的统计数据
- 自动检查约束满足情况和客户服务完成度

## 算法原理

求解器主要采用两阶段优化策略：

1. **改进的聚类阶段**：
   - 基于客户时间窗紧迫性、距离、需求密度等多因素进行分阶段聚类
   - 先处理时间窗紧迫的客户，再处理普通客户
   - 动态调整簇分布以平衡负载，提高整体效率
2. **路径优化阶段**：
   - 采用改进的插入算法构建初始路径
   - 综合考虑距离、时间和等待时间进行路径评估
   - 对未服务客户尝试重新插入现有路径或创建新路径

## 安装说明

### 依赖环境

- Python 3.6+
- 所需 Python 库：
  - pandas
  - numpy
  - matplotlib

### 安装步骤

1. 克隆或下载本项目代码
2. 安装依赖库：

bash运行

```bash
pip install pandas numpy matplotlib
```

## 使用方法

1. 将 VRPTW 数据文件（C1_*.txt 格式）放置在程序同一目录下
2. 运行主程序：

bash运行

```bash
python 2.py
```

1. 程序会自动处理所有数据文件，并在控制台输出求解过程和结果
2. 求解完成后，结果将保存为两个 Excel 文件：
   - `VRPTW优化求解结果.xlsx`：包含详细的求解结果
   - `VRPTW优化结果_简洁版.xlsx`：包含精简的关键指标

## 数据格式

程序支持解析的 VRPTW 数据文件应包含以下关键部分：

- VEHICLE 部分：定义车辆容量信息
- CUSTOMER 部分：定义客户信息，包括：
  - 客户 ID（0 表示 depot / 仓库）
  - x, y 坐标
  - 需求
  - 最早开始时间（ready_time）
  - 最晚结束时间（due_date）
  - 服务时间（service_time）

## 结果说明

求解结果包含以下关键指标：

- 车辆使用数量
- 总行驶距离
- 总耗时
- 服务客户数量 / 总客户数量
- 约束满足情况
- 所有客户是否都被服务

## 代码结构

plaintext

```plaintext
VRPTW求解器
├── VRPTWDataParser：数据解析器，负责加载和解析VRPTW数据文件
│   ├── load_data_files：加载所有数据文件
│   └── parse_data_file：解析单个数据文件
│
├── OptimizedVRPTWSolver：优化的VRPTW求解器
│   ├── solve：主求解函数
│   ├── improved_clustering：改进的聚类算法
│   ├── optimize_route_with_time_windows：带时间窗的路径优化
│   ├── reassign_unserved_customers：重新分配未服务客户
│   └── 辅助函数：距离计算、路径评估、簇优化等
│
└── main：主函数，协调数据加载、求解和结果输出
```

## 改进建议

1. 可以引入更先进的启发式算法（如遗传算法、模拟退火等）进一步优化路径
2. 增加可视化模块，直观展示车辆路径
3. 支持更多格式的输入数据和自定义参数配置
4. 实现并行计算以提高大规模问题的求解效率
5. 增加交互式界面，方便用户调整参数和查看结果

## 注意事项

- 程序默认对 C1_2_开头的文件设置最大车辆数为 20，其他文件为 100
- 若求解结果中存在未服务客户，可能需要调整最大车辆数或算法参数
- 复杂问题的求解可能需要较长时间，请耐心等待

------

通过使用本求解器，您可以高效解决带时间窗的车辆路径规划问题，优化物流配送效率，降低运营成本。